<%= form_for(@working_article, remote: true) do |f| %>

<div class="row">
  <div class="col-sm-12">
    <div id="panel-1" class="panel">
      <div class="panel-hdr">
        <div class="panel-toolbar pr-3 align-self-end">
          <ul id="demo_panel-tabs" class="nav nav-tabs border-bottom-0" role="tablist">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
                aria-expanded="false"><i class="fal fa-newspaper"></i> 섹션</a>
              <div class="dropdown-menu">
                <% if current_user && current_user.role == 'reporter' || current_user.role == 'marketing' %>
                <% case current_user.group %>
                <% when '1면' %>
                <a class="dropdown-item" data-toggle="tab" href="#first_group" role="tab">1면</a>
                <% when '정치' %>
                <a class="dropdown-item" data-toggle="tab" href="#second_group" role="tab">정치</a>
                <% when '자치행정' %>
                <a class="dropdown-item" data-toggle="tab" href="#third_group" role="tab">자치행정</a>
                <% when '국제통일' %>
                <a class="dropdown-item" data-toggle="tab" href="#fourth_group" role="tab">국제통일</a>
                <% when '금융' %>
                <a class="dropdown-item" data-toggle="tab" href="#fifth_group" role="tab">금융</a>
                <% when '산업' %>
                <a class="dropdown-item" data-toggle="tab" href="#sixth_group" role="tab">산업</a>
                <% when '정책' %>
                <a class="dropdown-item" data-toggle="tab" href="#seventh_group" role="tab">정책</a>
                <% when '기획' %>
                <a class="dropdown-item" data-toggle="tab" href="#eighth_group" role="tab">기획</a>
                <% when '오피니언' %>
                <a class="dropdown-item" data-toggle="tab" href="#nineth_group" role="tab">오피니언</a>
                <% end %>
                <% else %>
                <a class="dropdown-item" data-toggle="tab" href="#first_group" role="tab">1면</a>
                <a class="dropdown-item" data-toggle="tab" href="#second_group" role="tab">정치</a>
                <a class="dropdown-item" data-toggle="tab" href="#third_group" role="tab">자치행정</a>
                <a class="dropdown-item" data-toggle="tab" href="#fourth_group" role="tab">자치행정</a>
                <a class="dropdown-item" data-toggle="tab" href="#fifth_group" role="tab">금융</a>
                <a class="dropdown-item" data-toggle="tab" href="#sixth_group" role="tab">산업</a>
                <a class="dropdown-item" data-toggle="tab" href="#seventh_group" role="tab">정책</a>
                <a class="dropdown-item" data-toggle="tab" href="#eighth_group" role="tab">기획</a>
                <a class="dropdown-item" data-toggle="tab" href="#nineth_group" role="tab">오피니언</a>
                <% end %>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
                aria-expanded="false"><i class="fal fa-list-ol"></i> 기사배정</a>
              <div class="dropdown-menu">
                <a class="dropdown-item" data-toggle="tab" href="#tab_default-2" role="tab">
                  <% if @working_article.page.page_number == 1 %><%= "#{@working_article.page.section_name}" %>
                  <% else %><%= "#{@working_article.page.section_name}" %>면<% end %> 기사배정</a>
                <a class="dropdown-item" data-toggle="tab" href="#tab_default-3" role="tab">
                  <%= "#{@working_article.order}" %>번 기사배정</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#tab_default-4" role="tab">
              <i class="fal fa-edit"></i> <%= "#{@working_article.order}" %>번 기사편집
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#tab_default-5" role="tab">
              <i class="fal fa-eye"></i> <%= "#{@working_article.page.page_number}" %>면 미리보기
              </a>
            </li>
          </ul>
        </div>
        <h2> </h2>
        <div class="panel-toolbar">
          <button class="btn btn-panel" data-action="panel-collapse" data-toggle="tooltip" data-offset="0,10"
            data-original-title="Collapse"></button>
          <button class="btn btn-panel" data-action="panel-fullscreen" data-toggle="tooltip" data-offset="0,10"
            data-original-title="Fullscreen"></button>
          <button class="btn btn-panel" data-action="panel-close" data-toggle="tooltip" data-offset="0,10"
            data-original-title="Close"></button>
        </div>
      </div>
      <div class="panel-container show">
        <div class="panel-content">
          <!--div class="panel-tag">
            설명 설명
          </div-->

          <div class="tab-content p-3">

            <div class="tab-pane fade" id="nineth_group" role="tabpanel">
              <%= render 'issues/nineth_group' %>

            </div>
            <div class="tab-pane fade" id="tab_default-2" role="tabpanel">
              <!-- 면 전체 기사 배정 -->
              <% @pages.each do |page| %>
              <div class='row'>
                <div class='col-sm-2'>
                  <div class="card">
                    <%= raw page.to_story_svg %>
                  </div>
                  <% if page.color_page %>
                  <h4 align='center'>
                    <%= link_to "#{page.page_number}면", page_path(page), class: "btn btn-danger btn-xs" %></h4>
                  <% else %>
                  <h4 align='center'>
                    <%= link_to "#{page.page_number}면", page_path(page), class: "btn btn-default btn-xs" %></h4>
                  <% end %>
                </div>
                <div class="col-sm-10">
                  <div id="panel-1" class="panel">
                    <div class="panel-hdr">
                      <h2>
                        <%= "#{page.section_name} #{page.page_number}페이지 기사 리스트" %>
                      </h2>
                      <div class="panel-toolbar">
                        <button class="btn btn-panel" data-action="panel-collapse" data-toggle="tooltip"
                          data-offset="0,10" data-original-title="Collapse"></button>
                        <button class="btn btn-panel" data-action="panel-fullscreen" data-toggle="tooltip"
                          data-offset="0,10" data-original-title="Fullscreen"></button>
                        <button class="btn btn-panel" data-action="panel-close" data-toggle="tooltip" data-offset="0,10"
                          data-original-title="Close"></button>
                      </div>
                    </div>
                    <div class="panel-container show">
                      <div class="panel-content">
                        <div class="panel-tag">
                          <table class="table table-striped">
                            <thead>
                              <tr>
                                <th style="text-align:center;">순서</th>
                                <th style="text-align:center;">기자</th>
                                <th style="text-align:center;">제목</th>
                                <th style="text-align:center;">예상 글자수</th>
                                <th style="text-align:center;">기사배정</th>
                                <th style="text-align:center;">기사편집</th>
                              </tr>
                            </thead>
                            <tbody>
                              <% page.working_articles.sort_by{|a| a.order}.each do |working_article| %>
                              <% if working_article.story %>
                              <tr style="background-color:skyblue;">
                                <% else  %>
                              <tr>
                                <% end %>
                                <td style="text-align:center;"><%= working_article.order %></td>
                                <td style="text-align:center;"><%= working_article.reporter %></td>
                                <td><%= working_article.title %></td>
                                <td style="text-align:center;"><%= working_article.approximate_char_count %></td>
                                <td style="text-align:center;">
                                  <%= link_to '배정',change_story_working_article_path(working_article), method: :get, class: "btn btn-primary btn-sm" %>
                                </td>
                                <td style="text-align:center;">
                                  <%= link_to '편집',working_article_path(working_article), method: :get, class: "btn btn-info btn-sm" %>
                                </td>
                                <% end %>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <% end %>
            </div>

            <div class="tab-pane fade" id="tab_default-3" role="tabpanel">
              <!-- 기사배정 -->
              <div class="row">
                <div class="col-sm-7">
                  <%= render 'change_story_form', article: @working_article, stories: @stories%>
                </div>
                <div class="col-sm-5">
                  <p><%= render 'show_preview_by_column', article: @working_article %></p>
                </div>
              </div>
            </div>

            <div class="tab-pane fade show active" id="tab_default-4" role="tabpanel">
              <!-- 기사편집 -->
              <div class="row">
                <div class="col-sm-2">
                  <div class="card">
                    <%= raw @working_article.page.to_svg_with_jpg %>
                  </div>
                  <p align="center">
                    <% if @working_article.page.color_page %>
                    <h4 align='center'>
                      <%= link_to "#{@working_article.page.page_number}면", page_path(@working_article.page), class: "btn btn-danger btn-xs" %>
                    </h4>
                    <% else %>
                    <h4 align='center'>
                      <%= link_to "#{@working_article.page.page_number}면", page_path(@working_article.page), class: "btn btn-default btn-xs" %>
                    </h4>
                    <% end %>
                  </p>
                  <% if @working_article.page_number == 22 && @working_article.order != 2 || @working_article.page_number == 23 && @working_article.order != 2 %>
                  <% if @working_article.opinion_writer_id %>
                  <a href='<%= @working_article.opinion_writer_link %>'><img width="100px"
                      src="<%= @working_article.opinion_image_jpg_path %>"></img></a>
                  <% end %>
                  <h5 align='center'>오피니언 저자 원본사진 확인</h5>
                  <% elsif @working_article.page_number == 22 && @working_article.order == 2 %>
                  <img width="100px" src="<%= @working_article.profile_image_jpg_path %>"></img>
                  <h5 align='center'>오피니언 저자 원본사진 확인</h5>
                  <% else %>
                  <% end %>
                </div>

                <div class="col-sm-5">
                  <div id="panel-1-1" class="panel">
                    <div class="panel-hdr">
                      <h2>
                        <%= "#{@working_article.order}" %> 번 기사 미리보기
                      </h2>
                      <div class="panel-toolbar">
                        <button class="btn btn-panel" data-action="panel-collapse" data-toggle="tooltip"
                          data-offset="0,10" data-original-title="Collapse"></button>
                        <button class="btn btn-panel" data-action="panel-fullscreen" data-toggle="tooltip"
                          data-offset="0,10" data-original-title="Fullscreen"></button>
                        <button class="btn btn-panel" data-action="panel-close" data-toggle="tooltip" data-offset="0,10"
                          data-original-title="Close"></button>
                      </div>
                    </div>

                    <div class="panel-container show">
                      <div class="panel-content">
                        <!--div class="panel-tag">
                          이곳에 설명이 들어갑니다
                        </div-->

                        <div class="tab-content p-3">
                          <div class="col-sm-12">
                            <%= render 'show_preview', article: @working_article %>
                          </div>
                        </div>

                      </div>

                    </div>

                  </div>
                </div>

                <div class="col-sm-5">
                  <div id="panel-1-2" class="panel">
                    <div class="panel-hdr">
                      <div class="panel-toolbar pr-3 align-self-end">
                        <ul id="demo_panel-tabs" class="nav nav-tabs border-bottom-0" role="tablist">
                          <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#tab-article" role="tab">
                            <i class="fal fa-indent"></i> 기사 편집
                            </a>
                          </li>
                          <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#tab-photo" role="tab">
                            <i class="fal fa-image"></i> 사진 편집
                            </a>
                          </li>
                          <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#tab-graphic" role="tab">
                            <i class="fal fa-chart-pie"></i> 그래픽 편집
                            </a>
                          </li>
                        </ul>
                      </div>
                      <h2> </h2>
                      <div class="panel-toolbar">
                        <button class="btn btn-panel" data-action="panel-collapse" data-toggle="tooltip"
                          data-offset="0,10" data-original-title="Collapse"></button>
                        <button class="btn btn-panel" data-action="panel-fullscreen" data-toggle="tooltip"
                          data-offset="0,10" data-original-title="Fullscreen"></button>
                        <button class="btn btn-panel" data-action="panel-close" data-toggle="tooltip" data-offset="0,10"
                          data-original-title="Close"></button>
                      </div>
                    </div>

                    <div class="panel-container show">
                      <div class="panel-content">
                        <!--div class="panel-tag">
                          설명 설명
                        </div-->
                        <div class="tab-content p-3">
                          <div class="tab-pane fade show active" id="tab-article" role="tabpanel"
                            aria-labelledby="tab-article">
                            <% if @working_article.kind == '사설' || @working_article.kind == 'editorial' %>
                            <%= render 'editorial', article:@working_article, page_number:@working_article.page_number%>
                            <% elsif @working_article.kind == '기고' || @working_article.kind == 'opinion' %>
                            <%= render 'opinion', article: @working_article %>
                            <% else %>
                            <%= render 'form', article: @working_article %>
                            <% end %>
                          </div>

                          <div class="tab-pane fade" id="tab-photo" role="tabpanel" aria-labelledby="tab-photo">
                            <!-- 사진탭 -->
                            <div class="col-sm-12">
                              <% if @working_article.kind == '기사' || @working_article.kind == '사진' || @working_article.kind == '박스기고'%>
                              <div class="col-sm-12">
                                <% if @reporter_images.length > 0 %>
                                <%= render 'reporter_image', reporter_images: @reporter_images %>
                                <% end %>
                              </div>
                              <div class="col-sm-12">
                                <% @working_article.images.sort_by{|x| x.id}.each do |image| %>
                                <%= render 'images/form', image: image %>
                                <% end %>
                                <div class="col-sm-12 frame-2">
                                  <% if @working_article.images.length < 3 %>
                                  <%= form_with( model: @working_article, :html => { :multipart => true }, :url=>{action: 'upload_images'}) do |f| %>
                                  <%= f.fields_for :images, Image.new do |p| %>
                                  <br>
                                  <div class="input-group mb-3">
                                  <div class="input-group-prepend">
                                    <label class="btn btn-warning">
                                    사진 파일 찾기 <%= p.file_field :storage_image, class: "custom-file-input", style: "display:none;", :multiple => true, name: "images[image][]"%>
                                    </label>
                                  </div>
                                    <input type="text" placeholder="선택한 파일 없음" class="form-control width2" readonly="readonly" />
                                  <div class="input-group-append">
                                    <%= f.button "사진 올리기", issue: @working_article.issue,  class: "btn btn-warning btn-sm", data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> 처리중..."} %>
                                  </div>
                                </div>
                                  <!-- div class="form-group">
                                    <label class="form-label" for="inputGroupFile01"> </label>
                                    <div class="input-group-prepend">
                                      <label class="btn btn-warning btn-sm">
                                      사진 파일 찾기 <%= p.file_field :storage_image, class: "custom-file-input", style: "display:none;", :multiple => true, name: "images[image][]"%>
                                      </label>  <input type="text" placeholder="선택한 파일 없음" class="form-control width2 btn-sm" readonly="readonly" />
                                      <div class="input-group-append">
                                        <%= f.button "사진 올리기", issue: @working_article.issue,  class: "btn btn-warning", data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> 처리중..."} %>
                                      </div>
                                    </div>
                                    <% end %>
                                  </div -->
                                </div>
                              </div>
                              <% end %>
                              <% end %>
                              <% link_to "이미지 추가", add_image_article_path(@working_article), method: :get, class: "btn btn-sm btn-danger" %>
                              <% link_to "저자 이미지 추가", add_personal_image_article_path(@working_article), method: :get, class: "btn btn-sm btn-danger" %>
                              <br>
                              <hr>
                              <% end %>
                            </div>
                          </div>

                          <div class="tab-pane fade" id="tab-graphic" role="tabpanel" aria-labelledby="tab-graphic">
                            <!-- 그래픽탭 -->
                            <div class="col-xs-12 col-sm-12">
                              <% if @working_article.kind == '기사' || @working_article.kind == '사진' || @working_article.kind == '박스기고' %>
                              <div class="col-xs-12 col-sm-12">
                                <% if @reporter_graphics.length > 0 %>
                                <%= render 'reporter_graphic', reporter_graphics: @reporter_graphics %>
                                <% end %>
                              </div>
                              <div class="col-xs-12 col-sm-12">
                                <% @working_article.graphics.each do |graphic| %>
                                <%= render 'graphics/form', graphic: graphic %>
                                <% end %>
                                <div class="col-xs-12 col-sm-12 frame-2">
                                  <% if  @working_article.graphics.length <= 2 %>
                                  <%= form_with( model: @working_article, :html => { :multipart => true }, :url=>{action: 'upload_graphics'}) do |f| %>
                                  <%= f.fields_for :images, Image.new do |p| %>
                                  <br>
                                  <div class="field">
                                    <label class="btn btn-warning btn-sm">그래픽
                                      파일선택<%= p.file_field :image, style: "display: none;", :multiple => true, name:"images[image][]" %>
                                    </label><input type="text" placeholder="선택한 파일 없음"
                                      class="form-control width2 btn-sm" readonly="readonly">
                                  </div>
                                  <% end %>
                                  <div class="actions">
                                    <%= f.button "그래픽 올리기", issue: @working_article.issue, class: "btn btn-primary btn-sm", data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> 처리중..."} %>
                                  </div>
                                </div>
                              </div>
                              <% end %>
                              <% end %>
                              <% link_to "이미지 추가", add_image_article_path(@working_article), method: :get, class: "btn btn-sm btn-danger" %>
                              <% link_to "저자 이미지 추가", add_personal_image_article_path(@working_article), method: :get, class: "btn btn-sm btn-danger" %>
                              <% end %>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>

              </div>
            </div>

            <div class="tab-pane fade" id="tab_default-5" role="tabpanel">
              <!-- 페이지 전체보기 -->
              <div class="col-xs-12 col-sm-12">
                <div class="card">
                  <%= raw @working_article.page.to_svg_with_jpg %>
                </div>
                <p align="center">
                  <% if @working_article.page.color_page %>
                  <h4 align='center'>
                    <%= link_to "#{@working_article.page.page_number}면", page_path(@working_article.page), class: "btn btn-danger btn-xs" %>
                  </h4>
                  <% else %>
                  <h4 align='center'>
                    <%= link_to "#{@working_article.page.page_number}면", page_path(@working_article.page), class: "btn btn-default btn-xs" %>
                  </h4>
                  <% end %>
                </p>
              </div>
            </div>
          </div>

          <nav class="navbar navbar-default navbar-fixed-bottom">
            <div class="btn-group" role="group" aria-label="기능">
              <%= link_to "교정 전송", send_proof_reading_pdf_page_path(@working_article.page), method: :get, data: { confirm: '정말 보내시겠습니까?'}, class: "btn btn-default btn-sm" %>
              <%= link_to "인쇄 전송", send_pdf_to_printer_page_path(@working_article.page), method: :get, data: { confirm: '정말 보내시겠습니까?'}, class: "btn btn-default btn-sm" %>
              <%= link_to "페이지 PDF", download_pdf_page_path(@working_article.page), method: :get, class: "btn btn-default btn-sm" %>
              <%= link_to "기사 PDF", download_pdf_working_article_path(@working_article), method: :get, class: "btn btn-default btn-sm" %>
            </div>
          </nav>

          <% content_for :scripts_block do %>
          <script>
            $('#js_change_tab_direction input').on('change', function () {
              var newclass = $('input[name=radioNameTabDirection]:checked', '#js_change_tab_direction').val();
              $('#js_change_tab_direction').parent('.panel-tag').next('.nav.nav-tabs').removeClass().addClass(
                newclass);
            });
            $('#js_change_pill_direction input').on('change', function () {
              var newclass = $('input[name=radioNamePillDirection]:checked', '#js_change_pill_direction').val();
              $('#js_change_pill_direction').parent('.panel-tag').next('.nav.nav-pills').removeClass().addClass(
                newclass);
            });
          </script>
          <% end %>

        </div>
      </div>

    </div>
  </div>
</div>

<% end %>